{% extends "booth/base.html" %}
{% load i18n static %}

{% block logout %}
<a class="btn btn-danger" href="{% url 'logout' %}">Cerrar Sesión</a>
{% endblock %}

{% block content %}
<h1>Dashboard</h1>
<p class="lead">¡Te damos la bienvenida a Decide, {{username}}!</p>
{% if no_censo %}
    <p>No has sido añadido al censo de alguna votación</p>
{% else %}
    <h2>Votaciones disponibles</h2>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Votación</th>
            <th scope="col">Descripción</th>
            <th scope="col">Fecha de inicio</th>
          </tr>
        </thead>
        <tbody>
        {% for votacion in vot_dis %}
          <tr>
            <td><a href="{% url 'votacion' votacion.id %}">{{votacion.name}}</a></td>
            <td>{{votacion.desc}}</td>
            <td>{{votacion.start_date}}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% if no_vot_dis %}
      <p>No tiene votaciones disponibles</p>
    {% endif %}
    <div class="row">
      <h2 class="col-md-8">Realice sus sugerencias:</h2>
      <a class="btn btn-primary col-md-4" href="{% url 'suggesting-form' %}">Sugerencias</a>
    </div>
    <div class="row">
      <table class="table col-md-6">
        <thead>
          <tr>
            <th scope="col">Título</th>
            <th scope="col">Fecha de sugerencia</th>
          </tr>
        </thead>
        <tbody>
        {% for sugerencia in approved_suggestions %}
          <tr>
            <td><a href="{% url 'suggesting-detail' sugerencia.id %}">{{sugerencia.title}}</a></td>
            <td>{{sugerencia.suggesting_date}}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h2>Votaciones por meses del año</h2>
        <div id="container1">
          <canvas id="vot_por_mes_chart"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <h2>Votaciones de cada tipo</h2>
        <div id="container2">
          <canvas id="tipos_vot_chart"></canvas>
        </div>
      </div>
    </div>
{% endif %}
{% endblock %}

{% block extrabody %}

<script>
    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app-booth',
        data: {
            alertShow: false,
            alertMsg: "",
            alertLvl: "info",
            csspd: false,
            csstrit: false
        },
        beforeMount() {
            this.checkDaltCookie();
        },
        methods: {
            checkDaltCookie() {
                var cookies = document.cookie.split("; ");
                cookies.forEach((c) => {
                    var cs = c.split("=");
                    if (cs[0] == 'cssMode' && cs[1]) {
                        if (cs[1] == 'pd') {
                            this.csspd = true;
                            this.csstrit = false;
                        } else if (cs[1] == 'trit') {
                            this.csspd = false;
                            this.csstrit = true;
                        }
                    }
                });
            },
            change_css(v1,v2) {
                if (v1 & !v2) {
                    this.csspd = true;
                    this.csstrit = false;
                    document.cookie = 'cssMode=pd; path=/;';
                } else if (!v1 & v2) {
                    this.csspd = false;
                    this.csstrit = true;
                    document.cookie = 'cssMode=trit; path=/;';
                } else {
                    this.csspd = false;
                    this.csstrit = false;
                    document.cookie = 'cssMode=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                }
            },
            showAlert(lvl, msg) {
                this.alertLvl = lvl;
                this.alertMsg = msg;
                this.alertShow = true;
            }
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>

    var config1 = {
      type: 'bar',
      data: {
        datasets: [{
          data:{{votaciones_por_meses}},
          backgroundColor: '#007bff',
          label: 'Votaciones'
        }],
        labels: {{months|safe}}
      },
      options: {
        responsive: true
      }
    };

    var config2 = {
      type: 'bar',
      data: {
        datasets: [{
          data:{{tipo_votaciones}},
          backgroundColor: '#007bff',
          label: 'Votaciones'
        }],
        labels: ['Única', 'Múltiple', 'Rango']
      },
      options: {
        responsive: true
      }
    };

    window.onload = function() {
      var ctx1 = document.getElementById('vot_por_mes_chart').getContext('2d');
      var ctx2 = document.getElementById('tipos_vot_chart').getContext('2d');
      window.myBar = new Chart(ctx1, config1);
      window.myBar = new Chart(ctx2, config2);
    };
  </script>
{% endblock %}